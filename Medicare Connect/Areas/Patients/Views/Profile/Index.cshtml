@model Medicare_Connect.Areas.Patients.Models.PatientProfileViewModel
@{
    ViewData["Title"] = "Profile";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">Iphrofayela (Profile)</h1>
            <p class="text-muted mb-0">Update your personal and contact information</p>
        </div>
        <div>
            <a asp-area="Patients" asp-controller="Dashboard" asp-action="Index" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>
    </div>

    @if (TempData["StatusMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
            <i class="bi bi-check-circle me-2"></i> @TempData["StatusMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <form method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <div class="row g-4">
            <!-- Profile Photo and Quick Info -->
            <div class="col-lg-4 col-xl-3">
                <div class="card dashboard-card border-0 mb-4">
                    <div class="card-body text-center">
                        <div class="position-relative mx-auto mb-3" style="width: 150px; height: 150px;">
                            <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" style="width: 150px; height: 150px; overflow: hidden;">
                                @if (!string.IsNullOrEmpty(Model.ProfilePhotoPath) || TempData["ProfilePhotoPath"] != null)
                                {
                                    var photoPath = Model.ProfilePhotoPath ?? TempData["ProfilePhotoPath"]?.ToString();
                                    <img src="@photoPath" alt="Profile Photo" class="img-fluid" style="width: 100%; height: 100%; object-fit: cover;" />
                                }
                                else
                                {
                                    <i class="bi bi-person-circle text-primary" style="font-size: 8rem;"></i>
                                }
                            </div>
                            <label for="profilePhotoInput" class="btn btn-sm btn-primary rounded-circle position-absolute bottom-0 end-0" style="width: 35px; height: 35px; cursor: pointer;" title="Change Photo">
                                <i class="bi bi-camera-fill"></i>
                            </label>
                            <input asp-for="ProfilePhoto" type="file" id="profilePhotoInput" name="ProfilePhoto" accept="image/*" style="display: none;" onchange="previewImage(this);" />
                            @if (!string.IsNullOrEmpty(Model.ProfilePhotoPath) || TempData["ProfilePhotoPath"] != null)
                            {
                                <form asp-action="RemoveProfilePhoto" method="post" style="position: absolute; bottom: 0; left: 0;">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-danger rounded-circle" style="width: 35px; height: 35px;" title="Remove Photo">
                                        <i class="bi bi-trash-fill"></i>
                                    </button>
                                </form>
                            }
                        </div>
                        <h5 class="mb-1">@Model.FullName</h5>
                        <p class="text-muted mb-3">Patient</p>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save me-2"></i>Save Changes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Medical Aid Information -->
                <div class="card dashboard-card border-0">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Medical Aid Information</h5>
                        <div class="mb-3">
                            <label asp-for="MedicalAidScheme" class="form-label">Medical Aid Scheme</label>
                            <input asp-for="MedicalAidScheme" class="form-control" />
                            <span asp-validation-for="MedicalAidScheme" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="MedicalAidNumber" class="form-label">Medical Aid Number</label>
                            <input asp-for="MedicalAidNumber" class="form-control" />
                            <span asp-validation-for="MedicalAidNumber" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="MainMemberName" class="form-label">Main Member Name</label>
                            <input asp-for="MainMemberName" class="form-control" />
                            <span asp-validation-for="MainMemberName" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="DependantCode" class="form-label">Dependant Code</label>
                            <input asp-for="DependantCode" class="form-control" />
                            <span asp-validation-for="DependantCode" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Information Tabs -->
            <div class="col-lg-8 col-xl-9">
                <div class="card dashboard-card border-0">
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal" type="button" role="tab" aria-controls="personal" aria-selected="true">
                                    <i class="bi bi-person me-2"></i>Personal
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">
                                    <i class="bi bi-telephone me-2"></i>Contact
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="emergency-tab" data-bs-toggle="tab" data-bs-target="#emergency" type="button" role="tab" aria-controls="emergency" aria-selected="false">
                                    <i class="bi bi-exclamation-triangle me-2"></i>Emergency
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="medical-tab" data-bs-toggle="tab" data-bs-target="#medical" type="button" role="tab" aria-controls="medical" aria-selected="false">
                                    <i class="bi bi-heart-pulse me-2"></i>Medical
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content pt-4" id="profileTabsContent">
                            <!-- Personal Information Tab -->
                            <div class="tab-pane fade show active" id="personal" role="tabpanel" aria-labelledby="personal-tab">
                                <h5 class="mb-4">Personal Information</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="FullName" class="form-label">Full Name</label>
                                            <input asp-for="FullName" class="form-control" />
                                            <span asp-validation-for="FullName" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="IdNumber" class="form-label">ID Number</label>
                                            <input asp-for="IdNumber" class="form-control" />
                                            <span asp-validation-for="IdNumber" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="DateOfBirth" class="form-label">Date of Birth</label>
                                            <input asp-for="DateOfBirth" class="form-control" type="date" />
                                            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="Gender" class="form-label">Gender</label>
                                            <select asp-for="Gender" class="form-select">
                                                <option value="">Select Gender</option>
                                                <option value="Male">Male</option>
                                                <option value="Female">Female</option>
                                                <option value="Other">Other</option>
                                                <option value="Prefer not to say">Prefer not to say</option>
                                            </select>
                                            <span asp-validation-for="Gender" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Information Tab -->
                            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                <h5 class="mb-4">Contact Information</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="Email" class="form-label">Email Address</label>
                                            <input asp-for="Email" class="form-control" type="email" />
                                            <span asp-validation-for="Email" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="PhoneNumber" class="form-label">Phone Number</label>
                                            <input asp-for="PhoneNumber" class="form-control" />
                                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label asp-for="Address" class="form-label">Address</label>
                                            <input asp-for="Address" class="form-control" />
                                            <span asp-validation-for="Address" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="City" class="form-label">City</label>
                                            <input asp-for="City" class="form-control" />
                                            <span asp-validation-for="City" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label asp-for="Province" class="form-label">Province</label>
                                            <select asp-for="Province" class="form-select">
                                                <option value="">Select Province</option>
                                                <option value="Eastern Cape">Eastern Cape</option>
                                                <option value="Free State">Free State</option>
                                                <option value="Gauteng">Gauteng</option>
                                                <option value="KwaZulu-Natal">KwaZulu-Natal</option>
                                                <option value="Limpopo">Limpopo</option>
                                                <option value="Mpumalanga">Mpumalanga</option>
                                                <option value="Northern Cape">Northern Cape</option>
                                                <option value="North West">North West</option>
                                                <option value="Western Cape">Western Cape</option>
                                            </select>
                                            <span asp-validation-for="Province" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="mb-3">
                                            <label asp-for="PostalCode" class="form-label">Postal Code</label>
                                            <input asp-for="PostalCode" class="form-control" />
                                            <span asp-validation-for="PostalCode" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Emergency Contact Tab -->
                            <div class="tab-pane fade" id="emergency" role="tabpanel" aria-labelledby="emergency-tab">
                                <h5 class="mb-4">Emergency Contact Information</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="EmergencyContactName" class="form-label">Contact Name</label>
                                            <input asp-for="EmergencyContactName" class="form-control" />
                                            <span asp-validation-for="EmergencyContactName" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="EmergencyContactRelationship" class="form-label">Relationship</label>
                                            <select asp-for="EmergencyContactRelationship" class="form-select">
                                                <option value="">Select Relationship</option>
                                                <option value="Spouse">Spouse</option>
                                                <option value="Parent">Parent</option>
                                                <option value="Child">Child</option>
                                                <option value="Sibling">Sibling</option>
                                                <option value="Friend">Friend</option>
                                                <option value="Other">Other</option>
                                            </select>
                                            <span asp-validation-for="EmergencyContactRelationship" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="EmergencyContactPhone" class="form-label">Phone Number</label>
                                            <input asp-for="EmergencyContactPhone" class="form-control" />
                                            <span asp-validation-for="EmergencyContactPhone" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Medical Information Tab -->
                            <div class="tab-pane fade" id="medical" role="tabpanel" aria-labelledby="medical-tab">
                                <h5 class="mb-4">Medical Information</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label asp-for="BloodType" class="form-label">Blood Type</label>
                                            <select asp-for="BloodType" class="form-select">
                                                <option value="">Select Blood Type</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="Unknown">Unknown</option>
                                            </select>
                                            <span asp-validation-for="BloodType" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label asp-for="Allergies" class="form-label">Allergies</label>
                                            <textarea asp-for="Allergies" class="form-control" rows="2" placeholder="List any allergies, separated by commas"></textarea>
                                            <span asp-validation-for="Allergies" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label asp-for="ChronicConditions" class="form-label">Chronic Conditions</label>
                                            <textarea asp-for="ChronicConditions" class="form-control" rows="2" placeholder="List any chronic conditions"></textarea>
                                            <span asp-validation-for="ChronicConditions" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <label asp-for="CurrentMedications" class="form-label">Current Medications</label>
                                            <textarea asp-for="CurrentMedications" class="form-control" rows="2" placeholder="List any current medications and dosages"></textarea>
                                            <span asp-validation-for="CurrentMedications" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                
                reader.onload = function(e) {
                    const container = input.closest('.position-relative').querySelector('.rounded-circle');
                    
                    // Remove existing content
                    while (container.firstChild) {
                        container.removeChild(container.firstChild);
                    }
                    
                    // Create and add the image
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = 'Profile Photo';
                    img.className = 'img-fluid';
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    
                    container.appendChild(img);
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}


